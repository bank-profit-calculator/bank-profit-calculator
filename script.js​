// âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙˆØ§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª (Ù…Ø­Ø¯Ø«Ø©)
const bankProducts = [
  {
    bank: "Ø¨Ù†Ùƒ Ù…ØµØ±",
    certificates: [
      { 
        name: "Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù‚Ù…Ø©", 
        rate: 17, 
        type: "Ø´Ù‡Ø§Ø¯Ø©", 
        duration: "3 Ø³Ù†ÙˆØ§Øª",
        minAmount: 1000,
        currency: "EGP"
      },
      { 
        name: "ÙˆØ¯ÙŠØ¹Ø© Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©", 
        rate: 15.5, 
        type: "ÙˆØ¯ÙŠØ¹Ø©", 
        duration: "1 Ø³Ù†Ø©",
        minAmount: 5000,
        currency: "EGP"
      }
    ]
  },
  {
    bank: "Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ",
    certificates: [
      { 
        name: "Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±", 
        rate: 18.5, 
        type: "Ø´Ù‡Ø§Ø¯Ø©", 
        duration: "5 Ø³Ù†ÙˆØ§Øª",
        minAmount: 5000,
        currency: "EGP"
      },
      { 
        name: "ÙˆØ¯ÙŠØ¹Ø© Ù‚ØµÙŠØ±Ø© Ø§Ù„Ø£Ø¬Ù„", 
        rate: 16, 
        type: "ÙˆØ¯ÙŠØ¹Ø©", 
        duration: "6 Ø£Ø´Ù‡Ø±",
        minAmount: 10000,
        currency: "USD"
      }
    ]
  }
];

// âœ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
  populateBanks();
  
  // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø£ÙŠ Ù…Ø¯Ø®Ù„
  document.getElementById('amount').addEventListener('input', calculateInterest);
  document.getElementById('rate').addEventListener('input', calculateInterest);
  document.querySelectorAll('input[name="period"]').forEach(radio => {
    radio.addEventListener('change', calculateInterest);
  });
  document.getElementById('currency').addEventListener('change', calculateInterest);
});

// âœ… ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù†ÙˆÙƒ
function populateBanks() {
  const bankSelect = document.getElementById("bank");
  bankSelect.innerHTML = '<option value="" disabled selected>-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù†Ùƒ --</option>';
  
  bankProducts.forEach(bank => {
    const option = document.createElement("option");
    option.value = bank.bank;
    option.textContent = bank.bank;
    bankSelect.appendChild(option);
  });
}

// âœ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©
function updateCertificates() {
  const bankName = document.getElementById("bank").value;
  const certificateSelect = document.getElementById("certificate");
  const selectedFilter = document.querySelector('input[name="filterType"]:checked').value;

  certificateSelect.innerHTML = '<option value="" disabled selected>-- Ø§Ø®ØªØ± Ù…Ù†ØªØ¬ Ø¨Ù†ÙƒÙŠ --</option>';

  if (!bankName) return;

  const selectedBank = bankProducts.find(bank => bank.bank === bankName);
  if (!selectedBank) return;

  let filteredProducts = selectedBank.certificates;
  
  if (selectedFilter !== "all") {
    filteredProducts = filteredProducts.filter(product => product.type === selectedFilter);
  }

  filteredProducts.forEach(product => {
    const option = document.createElement("option");
    option.value = product.name;
    option.textContent = `${product.name} (${product.rate}%) - ${product.type}`;
    option.dataset.rate = product.rate;
    certificateSelect.appendChild(option);
  });
}

// âœ… ØªØ¹ÙŠÙŠÙ† Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
function setRateFromCertificate() {
  const certSelect = document.getElementById("certificate");
  const rateInput = document.getElementById("rate");
  
  if (certSelect.selectedIndex > 0) {
    rateInput.value = certSelect.options[certSelect.selectedIndex].dataset.rate;
    calculateInterest(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªÙŠØ¬Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  } else {
    rateInput.value = "";
  }
}

// âœ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø¨Ù†ÙƒÙŠ
function calculateInterest() {
  const amountInput = document.getElementById("amount");
  const rateInput = document.getElementById("rate");
  const period = document.querySelector('input[name="period"]:checked').value;
  const currency = document.getElementById("currency").value;
  const resultDiv = document.getElementById("result");

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
  if (!amountInput.value || !rateInput.value) {
    resultDiv.textContent = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©";
    return;
  }

  const amount = parseFloat(amountInput.value);
  const rate = parseFloat(rateInput.value);

  if (isNaN(amount) || isNaN(rate) || amount <= 0 || rate <= 0) {
    resultDiv.textContent = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø© Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±";
    return;
  }

  const yearlyInterest = (amount * rate) / 100;
  let result;

  switch (period) {
    case "daily":
      result = yearlyInterest / 365;
      break;
    case "monthly":
      result = yearlyInterest / 12;
      break;
    case "yearly":
      result = yearlyInterest;
      break;
  }

  const currencySymbol = getCurrencySymbol(currency);
  const periodName = getPeriodName(period);

  resultDiv.innerHTML = `
    <div class="result-card">
      <h3>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
      <p>Ø§Ù„Ø¹Ø§Ø¦Ø¯ ${periodName}: <strong>${result.toFixed(2)} ${currencySymbol}</strong></p>
      <p>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ: ${amount.toFixed(2)} ${currencySymbol}</p>
      <p>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${(amount + (period === 'yearly' ? result : yearlyInterest)).toFixed(2)} ${currencySymbol}</p>
    </div>
  `;
}

// âœ… Ø§Ø³Ù… Ø§Ù„ÙØªØ±Ø©
function getPeriodName(period) {
  const periods = {
    daily: "Ø§Ù„ÙŠÙˆÙ…ÙŠ",
    monthly: "Ø§Ù„Ø´Ù‡Ø±ÙŠ",
    yearly: "Ø§Ù„Ø³Ù†ÙˆÙŠ"
  };
  return periods[period] || '';
}

// âœ… Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø©
function getCurrencySymbol(currency) {
  const symbols = {
    EGP: "Ø¬Ù†ÙŠÙ‡",
    USD: "Ø¯ÙˆÙ„Ø§Ø±",
    SAR: "Ø±ÙŠØ§Ù„",
    EUR: "ÙŠÙˆØ±Ùˆ"
  };
  return symbols[currency] || '';
}

// âœ… ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
function toggleTheme() {
  document.body.classList.toggle('dark-theme');
  const btn = document.getElementById("toggleTheme");
  btn.textContent = document.body.classList.contains("dark-theme") 
    ? "â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ" 
    : "ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ";
  
  // Ø­ÙØ¸ Ø§Ù„ØªÙØ¶ÙŠÙ„ ÙÙŠ localStorage
  localStorage.setItem('darkMode', document.body.classList.contains('dark-theme'));
}

// âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
function checkDarkModePreference() {
  if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-theme');
    document.getElementById("toggleTheme").textContent = "â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ";
  }
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
checkDarkModePreference();
